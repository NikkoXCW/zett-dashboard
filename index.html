<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volvo BEV Trial Data</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #f4f4f4; text-align: center; }
        .value-container { text-align: left; max-width: 800px; margin: auto; }
        .value-box { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .value-box label { font-weight: bold; white-space: nowrap; }
        .value-box span { font-size: 18px; font-weight: bold; color: #63973F; }
        .filter-container { margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; cursor: pointer; }
        th { background-color: #f4f4f4; }
        .chart-container { display: none; position: fixed; top: 10%; left: 10%; width: 80%; height: 60%; background: white; padding: 20px; border: 1px solid #ddd; }
        .close-btn { cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>
    <h2>ZETT - Volvo BEV Trial - Sutco</h2>
    <div class="value-container">
        <div class="value-box">
            <label for="trialStartDate">Trial Operation Start Date:</label>
            <span id="trialStartDate">January 29, 2025</span>
        </div>
        <div class="value-box">
            <label for="cellA3">Operating Days:</label>
            <span id="cellA3"></span>
        </div>
        <div class="value-box">
            <label for="cellJ3">Total Net Loads (Kg):</label>
            <span id="cellJ3"></span>
        </div>
        <div class="value-box">
            <label for="cellK3">Total Operating Mileage (Km):</label>
            <span id="cellK3"></span>
        </div>
        <div class="value-box">
            <label for="cellP3">Average Fuel Consumption Rate (kWh/Km):</label>
            <span id="cellP3"></span>
        </div>
        <div class="value-box">
            <label for="cellQ3">Average Energy Efficiency 1 (CAD$/Km):</label>
            <span id="cellQ3"></span>
        </div>
        <div class="value-box">
            <label for="cellR3">Average Energy Efficiency 2 (CAD$/Km):</label>
            <span id="cellR3"></span>
        </div>
        <div class="value-box">
            <label for="cellS3">CO2 Emission Reduction (Kg):</label>
            <span id="cellS3"></span>
        </div>
    </div>
    <div class="filter-container">
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate">
        <button onclick="filterData()">Filter</button>
    </div>
    <table>
        <thead>
            <tr id="tableHeader"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
    <div class="chart-container" id="chartPopup">
        <span class="close-btn" onclick="closeChart()">&times;</span>
        <canvas id="trendChart"></canvas>
    </div>
    <script>
        const apiKey = 'AIzaSyC8f4hfYHPD8ZjffE2BlmCbEAmkgVJQsOQ';
        const sheetId = '1Tw-3NfzRG7JhzLsjLBfrRF__Plo4BZS8RWRa-csbiH4';
        const range = 'VolvoBEV!A4:AB';
        let sheetData = [];
        
        async function fetchSheetData() {
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                if (data.values) {
                    sheetData = data.values;
                    renderTable(sheetData);
                    populateValueBoxes(sheetData[0]);
                }
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        
        function populateValueBoxes(row) {
            document.getElementById('trialStartDate').innerText = row[1] || '';
            document.getElementById('cellA3').innerText = row[0] || '';
            document.getElementById('cellJ3').innerText = row[9] || '';
            document.getElementById('cellK3').innerText = row[10] || '';
            document.getElementById('cellP3').innerText = row[15] || '';
            document.getElementById('cellQ3').innerText = row[16] || '';
            document.getElementById('cellR3').innerText = row[17] || '';
            document.getElementById('cellS3').innerText = row[18] || '';
        }
        
        function renderTable(data) {
            const tableHeader = document.getElementById("tableHeader");
            const tableBody = document.getElementById("tableBody");
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            
            const columns = ["Date", "Operating Days", "Total Net Loads", "Total Mileage", "Column L", "Column M", "Column N", "Column O", "Avg Consumption", "Energy Efficiency 1", "Energy Efficiency 2", "CO2 Reduction", "Column U", "Column V", "Column W", "Column X", "Column Y", "Column Z", "Column AA", "Column AB"];
            
            columns.forEach(col => {
                const th = document.createElement("th");
                th.innerText = col;
                th.onclick = () => showTrend(col);
                tableHeader.appendChild(th);
            });
            
            data.forEach(row => {
                const tr = document.createElement("tr");
                row.forEach(cell => {
                    const td = document.createElement("td");
                    td.innerText = cell;
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }
        
        fetchSheetData();
    </script>
</body>
</html>
